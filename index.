<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EcoQuiz â€” ìƒíƒœ&í™˜ê²½ í€´ì¦ˆ</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1: #0f172a; /* deep navy */
      --accent1: #00f5a0; /* neon green */
      --accent2: #7c3aed; /* violet */
      --accent3: #06b6d4; /* teal */
      --glass: rgba(255,255,255,0.06);
      --glass-2: rgba(255,255,255,0.04);
      --card-radius: 20px;
      --glass-border: rgba(255,255,255,0.08);
      color-scheme: dark;
    }

    /* Reset */
    *{box-sizing:border-box}
    html,body,#app{height:100%}
    body{
      margin:0;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: radial-gradient(1200px 700px at 10% 10%, rgba(124,58,237,0.12), transparent 8%),
                  radial-gradient(1000px 600px at 90% 90%, rgba(6,182,212,0.08), transparent 10%),
                  linear-gradient(180deg,var(--bg1) 0%, #071127 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;align-items:center;justify-content:center;
      padding:24px;
    }

    /* App container fills viewport */
    .container{
      width:100%;max-width:1200px;height:100%;
      display:flex;flex-direction:column;gap:18px;
    }

    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 18px;border-radius:14px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid var(--glass-border);
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      backdrop-filter: blur(8px);
    }

    .logo{
      display:flex;align-items:center;gap:12px;font-weight:700;font-size:18px;color:white
    }
    .logo-badge{
      width:44px;height:44px;border-radius:10px;display:grid;place-items:center;
      background: linear-gradient(135deg,var(--accent1),var(--accent2));
      color:#051024;font-weight:900;font-size:20px;box-shadow:0 8px 24px rgba(124,58,237,0.24);
    }

    .controls{display:flex;gap:10px;align-items:center}
    .btn{padding:10px 14px;border-radius:12px;border:none;cursor:pointer;font-weight:600}
    .btn-ghost{background:transparent;color:rgba(255,255,255,0.85);border:1px solid rgba(255,255,255,0.06)}
    .btn-primary{background:linear-gradient(90deg,var(--accent1),var(--accent3));color:#031018;box-shadow:0 12px 30px rgba(0,245,160,0.08)}

    main{
      flex:1;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;
    }

    .card{
      width:100%;height:100%;padding:28px;border-radius:var(--card-radius);background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border:1px solid var(--glass-border);box-shadow: 0 20px 60px rgba(2,6,23,0.6);display:flex;flex-direction:column;gap:18px;
    }

    .topbar{display:flex;align-items:center;justify-content:space-between}

    .progress-wrap{flex:1;margin-left:18px}
    .progress{height:10px;border-radius:999px;background:var(--glass);overflow:hidden}
    .progress > i{display:block;height:100%;width:0%;border-radius:999px;background:linear-gradient(90deg,var(--accent2),var(--accent1));transition:width 450ms cubic-bezier(.2,.8,.2,1)}

    .question-area{display:flex;gap:20px;align-items:flex-start;flex:1}
    .qside{flex:1}
    .question{font-size:20px;font-weight:700;color:white;margin-bottom:8px}
    .meta{font-size:13px;color:rgba(255,255,255,0.6);margin-bottom:18px}

    .options{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .opt{padding:14px;border-radius:12px;background:linear-gradient(180deg,var(--glass-2),transparent);border:1px solid rgba(255,255,255,0.03);cursor:pointer;transition:all 220ms;display:flex;gap:12px;align-items:center}
    .opt:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(2,6,23,0.45)}
    .opt.selected{outline:3px solid rgba(255,255,255,0.04);box-shadow:0 14px 40px rgba(0,0,0,0.6)}
    .opt.correct{background:linear-gradient(90deg, rgba(0,245,160,0.12), rgba(124,58,237,0.06));border:1px solid rgba(0,245,160,0.24)}
    .opt.wrong{background:linear-gradient(90deg, rgba(255,75,75,0.06), rgba(255,255,255,0.02));border:1px solid rgba(255,75,75,0.14)}

    .opt .label{width:34px;height:34px;border-radius:8px;display:grid;place-items:center;font-weight:800;background:rgba(0,0,0,0.25);color:white}
    .opt .text{font-weight:600;color:rgba(255,255,255,0.92)}

    .rightpane{width:320px;display:flex;flex-direction:column;gap:14px}
    .card-mini{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid var(--glass-border)}

    .footer{display:flex;gap:12px;align-items:center;justify-content:flex-end}
    .big{font-size:18px;font-weight:800}

    /* small screens */
    @media (max-width:900px){
      .question-area{flex-direction:column}
      .options{grid-template-columns:1fr}
      .rightpane{width:100%}
    }

    /* Confetti canvas covers main area */
    #confetti{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none}

    /* micro-animations */
    .pulse{animation:pulse 2.4s infinite}
    @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}

    footer.note{color:rgba(255,255,255,0.6);font-size:13px;text-align:center;padding:8px}
  </style>
</head>
<body>
  <div id="app" class="container">
    <header>
      <div class="logo">
        <div class="logo-badge">E</div>
        <div>
          <div style="font-size:14px;opacity:0.9">EcoQuiz</div>
          <div style="font-size:11px;color:rgba(255,255,255,0.45);margin-top:2px">ìƒíƒœ & í™˜ê²½ í€´ì¦ˆ â€” ë°°ìš°ë©° ì§€í‚¤ëŠ” ì§€êµ¬</div>
        </div>
      </div>

      <div class="controls">
        <button class="btn btn-ghost" id="shuffleBtn" title="ë¬¸ì œ ì„ê¸°">ğŸ”€ ì„ê¸°</button>
        <button class="btn btn-ghost" id="resetBtn" title="í€´ì¦ˆ ì´ˆê¸°í™”">âŸ² ì´ˆê¸°í™”</button>
        <button class="btn btn-primary" id="startBtn">ì‹œì‘í•˜ê¸°</button>
      </div>
    </header>

    <main>
      <div class="card">
        <div class="topbar">
          <div style="display:flex;align-items:center;gap:12px">
            <div style="font-weight:800;color:rgba(255,255,255,0.95)">ë¬¸ì œ <span id="qIndex">0</span>/<span id="qTotal">0</span></div>
            <div class="meta" id="difficulty">ë‚œì´ë„: ì‰½ìŒ</div>
            <div class="progress-wrap">
              <div class="progress"><i id="progressBar"></i></div>
            </div>
          </div>
          <div style="display:flex;gap:10px;align-items:center">
            <div class="card-mini" id="timer">â±ï¸ 00:00</div>
            <div class="card-mini">ğŸ’¯ ì ìˆ˜: <span id="score">0</span></div>
          </div>
        </div>

        <div class="question-area">
          <div class="qside">
            <div class="question" id="questionText">ì¤€ë¹„ë˜ë©´ ì‹œì‘ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
            <div class="meta" id="explainText">í€´ì¦ˆëŠ” í™˜ê²½ ê´€ë ¨ ìƒì‹ê³¼ ìƒíƒœ ì§€ì‹ì„ ë‹¤ë£¹ë‹ˆë‹¤. ì˜ˆì‹œ ë¬¸ì œë“¤ì„ í¬í•¨í•˜ê³  ìˆì–´ìš”.</div>

            <div class="options" id="options"></div>
          </div>

          <aside class="rightpane">
            <div class="card-mini">
              <div style="font-size:13px;color:rgba(255,255,255,0.65);">ì •ë‹µ í•´ì„¤</div>
              <div id="explanation" style="margin-top:8px;font-weight:600;color:rgba(255,255,255,0.92)">ì •ë‹µì„ ê³ ë¥´ë©´ í•´ì„¤ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
            </div>

            <div class="card-mini">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-size:13px;color:rgba(255,255,255,0.65)">ë‚¨ì€ ë¬¸ì œ</div>
                <div id="remaining" style="font-weight:800">0</div>
              </div>
            </div>

            <div class="card-mini">
              <div style="font-size:13px;color:rgba(255,255,255,0.65)">í•˜ì´ìŠ¤ì½”ì–´</div>
              <div id="highscore" style="font-weight:900;font-size:18px;margin-top:6px">0</div>
            </div>

            <div style="margin-top:auto;display:flex;gap:8px">
              <button class="btn btn-ghost" id="prevBtn">â—€ ì´ì „</button>
              <button class="btn btn-primary" id="nextBtn">ë‹¤ìŒ â–¶</button>
            </div>
          </aside>
        </div>

        <div class="footer">
          <div style="flex:1;color:rgba(255,255,255,0.6);font-size:13px">í™˜ê²½ í€´ì¦ˆ â€” êµìœ¡ìš© ì½˜í…ì¸ ì…ë‹ˆë‹¤. (ìˆ˜ì • ê°€ëŠ¥)</div>
          <div style="display:flex;gap:8px">
            <button id="addQ" class="btn btn-ghost">â• ë¬¸ì œ ì¶”ê°€</button>
            <button id="downloadBtn" class="btn btn-ghost">â¬‡ ì €ì¥</button>
          </div>
        </div>

      </div>
      <canvas id="confetti"></canvas>
    </main>

    <footer class="note">Tip: <strong>ì‹œì‘í•˜ê¸°</strong>ë¥¼ ëˆŒëŸ¬ í€´ì¦ˆë¥¼ í’€ê³ , ì›í•˜ëŠ” ë¬¸í•­ì€ script ë‚´ë¶€ì˜ <code>questions</code> ë°°ì—´ì„ í¸ì§‘í•´ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</footer>
  </div>

  <script>
    // Questions: edit these to customize the quiz. Each item: {q, opts, answer (index), explanation, difficulty}
    const questions = [
      {q:'ì§€êµ¬ ì˜¨ë‚œí™”ì˜ ì£¼ëœ ì›ì¸ì´ ì•„ë‹Œ ê²ƒì€?', opts:['í™”ì„ì—°ë£Œ ì—°ì†Œ','ì‚¼ë¦¼ íŒŒê´´','í™”ì‚° í­ë°œ','ë©”íƒ„ ë°°ì¶œ'], answer:2, explanation:'í™”ì‚° í­ë°œì€ ë‹¨ê¸°ì  ê¸°í›„ë³€í™”ë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆì§€ë§Œ í˜„ì¬ì˜ ì§€ì†ì ì¸ ì§€êµ¬ì˜¨ë‚œí™”ì˜ ì£¼ì›ì¸ì€ ì¸ê°„ í™œë™(í™”ì„ì—°ë£Œ, ì‚°ë¦¼ íŒŒê´´, ë†ì—… ë“±)ì…ë‹ˆë‹¤.', difficulty:'ì¤‘'},
      {q:'ë‹¤ìŒ ì¤‘ ìƒë¬¼ë‹¤ì–‘ì„±ì´ ë†’ì€ ì„œì‹ì§€ëŠ”?', opts:['ë‹¨ì¼ ì‘ë¬¼ ì¬ë°°ì§€','ë„ì‹œ ì¤‘ì‹¬ê°€','ì—´ëŒ€ìš°ë¦¼','ì‚¬ë§‰'], answer:2, explanation:'ì—´ëŒ€ìš°ë¦¼ì€ ë‹¤ì–‘í•œ ê¸°í›„ì™€ êµ¬ì¡°ë¡œ ì¸í•´ ì„¸ê³„ì—ì„œ ìƒë¬¼ë‹¤ì–‘ì„±ì´ ê°€ì¥ ë†’ì€ ì§€ì—­ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.', difficulty:'ì‰¬ì›€'},
      {q:'í”Œë¼ìŠ¤í‹± ì˜¤ì—¼ ë¬¸ì œì—ì„œ ë¯¸ì„¸í”Œë¼ìŠ¤í‹±ì´ ì¸ì²´ì™€ ìƒíƒœê³„ì— ìœ í•´í•œ ì´ìœ ë¡œ ì˜³ì§€ ì•Šì€ ê²ƒì€?', opts:['ìƒë¬¼ì²´ì˜ ì†Œí™”ê¸°ê´€ì„ ë§‰ëŠ”ë‹¤','í™”í•™ë¬¼ì§ˆì„ í¡ì°©í•´ ì „ë‹¬í•œë‹¤','ìê¸°ë°œê´‘ íŠ¹ì„±ì´ ìˆì–´ í–‡ë¹›ì„ ë°˜ì‚¬í•œë‹¤','ë¨¹ì´ì‚¬ìŠ¬ì„ í†µí•´ ì¶•ì ëœë‹¤'], answer:2, explanation:'ë¯¸ì„¸í”Œë¼ìŠ¤í‹±ì€ ìì²´ë¡œ ìê¸°ë°œê´‘ íŠ¹ì„±ì´ ì—†ìœ¼ë©°, ì£¼ëœ ë¬¸ì œëŠ” ë¬¼ë¦¬ì Â·í™”í•™ì  ì˜í–¥ê³¼ ì¶•ì ì„±ì…ë‹ˆë‹¤.', difficulty:'ì¤‘'},
      {q:'ì¬ìƒì—ë„ˆì§€ì˜ ëŒ€í‘œì ì¸ ì˜ˆê°€ ì•„ë‹Œ ê²ƒì€?', opts:['íƒœì–‘ê´‘','í’ë ¥','ì„íƒ„ í™”ë ¥','ì§€ì—´'], answer:2, explanation:'ì„íƒ„ í™”ë ¥ì€ ì¬ìƒë¶ˆê°€ëŠ¥í•œ í™”ì„ì—°ë£Œ ê¸°ë°˜ ë°œì „ ë°©ì‹ì…ë‹ˆë‹¤.', difficulty:'ì‰¬ì›€'},
      {q:'ë©¸ì¢…ìœ„ê¸°ì¢…ì„ ë³´í˜¸í•˜ê¸° ìœ„í•œ íš¨ê³¼ì ì¸ ë°©ë²•ì€?', opts:['ì„œì‹ì§€ ë³µì›','ë°€ë µ ì¥ë ¤','ì„œì‹ì§€ íŒŒê´´','ë¶ˆë²• ë¬´ì—­ ì´‰ì§„'], answer:0, explanation:'ì„œì‹ì§€ ë³µì› ë° ë³´í˜¸ëŠ” ë©¸ì¢…ìœ„ê¸°ì¢… ë³´ì „ì— ê°€ì¥ ì¤‘ìš”í•œ ì „ëµ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.', difficulty:'ì‰¬ì›€'},
      {q:'íƒ„ì†Œë°œìêµ­(carbon footprint)ì„ ì¤„ì´ê¸° ìœ„í•œ ì‹¤ì²œìœ¼ë¡œ ì ì ˆí•˜ì§€ ì•Šì€ ê²ƒì€?', opts:['ëŒ€ì¤‘êµí†µ ì´ìš©','ìœ¡ë¥˜ ì¤‘ì‹¬ ì‹ë‹¨ í™•ëŒ€','ì—ë„ˆì§€ íš¨ìœ¨ ê°€ì „ ì‚¬ìš©','ì¼íšŒìš©í’ˆ ì¤„ì´ê¸°'], answer:1, explanation:'ìœ¡ë¥˜, íŠ¹íˆ ì†Œê³ ê¸° ì¤‘ì‹¬ì˜ ì‹ë‹¨ì€ ì˜¨ì‹¤ê°€ìŠ¤ ë°°ì¶œì´ ë†’ì•„ íƒ„ì†Œë°œìêµ­ì„ ëŠ˜ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', difficulty:'ì¤‘'},
      {q:'í•˜ì²œì˜ ë¶€ì˜ì–‘í™”(eutrophication) ì£¼ìš” ì›ì¸ì€?', opts:['ì§ˆì†Œì™€ ì¸ì˜ ê³¼ë‹¤ ìœ ì…','ë‹´ìˆ˜ ì–´ì¢…ì˜ ê³¼ë‹¤ í¬íš','ê°•ë°”ë‹¥ ì¤€ì„¤','ìˆ˜ì˜¨ ì €í•˜'], answer:0, explanation:'ë†ì—…ë¹„ë£Œë‚˜ í•˜ìˆ˜ë¡œ ì¸í•œ ì§ˆì†ŒÂ·ì¸ì˜ ê³¼ë‹¤ ìœ ì…ì´ ì¡°ë¥˜ë²ˆì„±ê³¼ ë¶€ì˜ì–‘í™”ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤.', difficulty:'ì¤‘'},
      {q:'ë„ì‹œì—´ì„¬ í˜„ìƒì„ ì™„í™”ì‹œí‚¤ëŠ” ë°©ë²•ìœ¼ë¡œ ì ì ˆí•œ ê²ƒì€?', opts:['ì•„ìŠ¤íŒ”íŠ¸ ë©´ì  í™•ëŒ€','ë…¹ì§€ í™•ëŒ€ ë° ì˜¥ìƒë…¹í™”','ê±´ë¬¼ ë†’ì´ ì œí•œ ì² í','ë°¤ì— ë” ë§ì€ ê°€ë¡œë“± ì„¤ì¹˜'], answer:1, explanation:'ë…¹ì§€ í™•ëŒ€ì™€ ì˜¥ìƒë…¹í™”ëŠ” ì¦ë°œì‚°ê³¼ ê·¸ëŠ˜ì„ í†µí•´ í‘œë©´ì˜¨ë„ë¥¼ ë‚®ì¶° ë„ì‹œì—´ì„¬ì„ ì™„í™”í•©ë‹ˆë‹¤.', difficulty:'ì‰¬ì›€'}
    ];

    // App state
    let state = {
      idx:0,score:0,started:false,selected:null,shuffled:[],timeStart:null,totalSeconds:0
    };

    // Elements
    const qIndex = document.getElementById('qIndex');
    const qTotal = document.getElementById('qTotal');
    const questionText = document.getElementById('questionText');
    const explainText = document.getElementById('explainText');
    const optionsDiv = document.getElementById('options');
    const explanation = document.getElementById('explanation');
    const remaining = document.getElementById('remaining');
    const scoreEl = document.getElementById('score');
    const highscoreEl = document.getElementById('highscore');
    const progressBar = document.getElementById('progressBar');
    const qTotalEl = document.getElementById('qTotal');
    const timerEl = document.getElementById('timer');

    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const addQBtn = document.getElementById('addQ');
    const downloadBtn = document.getElementById('downloadBtn');

    // Confetti canvas
    const confettiCanvas = document.getElementById('confetti');
    const cc = confettiCanvas.getContext && confettiCanvas.getContext('2d');
    function resizeCanvas(){confettiCanvas.width = confettiCanvas.clientWidth; confettiCanvas.height = confettiCanvas.clientHeight}
    window.addEventListener('resize',resizeCanvas);
    resizeCanvas();

    // util: shuffle indices
    function shuffledIndices(n){const arr=Array.from({length:n},(_,i)=>i);for(let i=n-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}

    function init(){
      state.idx=0;state.score=0;state.selected=null;state.started=false;state.totalSeconds=0;state.timeStart=null;
      state.shuffled = shuffledIndices(questions.length);
      qTotal.textContent = questions.length; qTotalEl.textContent = questions.length;
      remaining.textContent = questions.length;
      scoreEl.textContent = 0; explanation.textContent = 'ì •ë‹µì„ ê³ ë¥´ë©´ í•´ì„¤ì´ í‘œì‹œë©ë‹ˆë‹¤.';
      const hs = localStorage.getItem('ecoHighscore') || 0; highscoreEl.textContent = hs;
      progressBar.style.width = '0%';
      questionText.textContent = 'ì¤€ë¹„ë˜ë©´ ì‹œì‘ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.'; explainText.textContent = 'í€´ì¦ˆëŠ” í™˜ê²½ ê´€ë ¨ ìƒì‹ê³¼ ìƒíƒœ ì§€ì‹ì„ ë‹¤ë£¹ë‹ˆë‹¤.';
      optionsDiv.innerHTML = '';
    }

    function renderQuestion(){
      const realIdx = state.shuffled[state.idx];
      const item = questions[realIdx];
      qIndex.textContent = state.idx+1; qTotal.textContent = questions.length;
      questionText.textContent = item.q;
      explainText.textContent = `ë‚œì´ë„: ${item.difficulty}`;
      remaining.textContent = questions.length - (state.idx);

      optionsDiv.innerHTML = '';
      item.opts.forEach((t,i)=>{
        const el = document.createElement('div');el.className='opt';el.dataset.i=i;
        el.innerHTML = `<div class="label">${String.fromCharCode(65+i)}</div><div class="text">${t}</div>`;
        el.addEventListener('click',()=>selectOption(el,i));
        optionsDiv.appendChild(el);
      });

      // update progress
      const pct = Math.round((state.idx / questions.length)*100);
      progressBar.style.width = pct + '%';

      // update timer start
      if(!state.timeStart){state.timeStart = Date.now()}
    }

    function selectOption(el,i){
      if(!state.started) return;
      if(state.selected!==null) return; // only first answer counts
      state.selected = i;
      const realIdx = state.shuffled[state.idx];
      const item = questions[realIdx];
      const optsEls = Array.from(optionsDiv.children);
      optsEls.forEach((o,idx)=>{
        o.classList.remove('selected');
        if(idx===i) o.classList.add('selected');
      });

      // mark correct/wrong
      optsEls.forEach((o,idx)=>{
        if(idx===item.answer) o.classList.add('correct');
        else if(idx===i && idx!==item.answer) o.classList.add('wrong');
        o.style.pointerEvents='none';
      });

      // update score
      if(i===item.answer){state.score+=10;scoreEl.textContent=state.score; explanation.textContent = item.explanation; triggerConfetti();}
      else {explanation.textContent = item.explanation}

      // update progress bar to reflect answered
      const pct = Math.round(((state.idx+1) / questions.length)*100);
      progressBar.style.width = pct + '%';

      // auto-advance after a short delay
      setTimeout(()=>{
        // allow manual next as well
      },600);

      // update highscore
      const hs = Number(localStorage.getItem('ecoHighscore')||0);
      if(state.score>hs) {localStorage.setItem('ecoHighscore',state.score);highscoreEl.textContent=state.score}
    }

    prevBtn.addEventListener('click',()=>{
      if(state.idx>0){state.idx--;state.selected=null;renderQuestion();}
    });

    nextBtn.addEventListener('click',()=>{
      if(!state.started){alert('ë¨¼ì € ì‹œì‘ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');return}
      if(state.idx < questions.length-1){state.idx++;state.selected=null;renderQuestion();}
      else {finishQuiz();}
    });

    startBtn.addEventListener('click',()=>{
      if(!state.started){state.started=true;state.timeStart = Date.now();startBtn.textContent='ì¤‘ë‹¨';renderQuestion();}
      else {state.started=false;startBtn.textContent='ë‹¤ì‹œ ì‹œì‘';}
    });

    resetBtn.addEventListener('click',()=>{
      if(confirm('í€´ì¦ˆë¥¼ ì´ˆê¸°í™”í•˜ê³  ì²˜ìŒë¶€í„° ì‹œì‘í• ê¹Œìš”?')){init();}
    });

    shuffleBtn.addEventListener('click',()=>{state.shuffled = shuffledIndices(questions.length);state.idx=0;init();renderQuestion();});

    addQBtn.addEventListener('click',()=>{
      const q = prompt('ë¬¸ì œ ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”'); if(!q) return;
      const opts = [];
      for(let i=0;i<4;i++){const o = prompt(`ì˜µì…˜ ${i+1} ì…ë ¥ (ì·¨ì†Œí•˜ë©´ ë¹ˆì¹¸)`);opts.push(o||'');}
      const ans = Number(prompt('ì •ë‹µ ì¸ë±ìŠ¤(0~3)ë¥¼ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”'));
      const exp = prompt('í•´ì„¤ì„ ì…ë ¥í•˜ì„¸ìš”')||'';
      const diff = prompt('ë‚œì´ë„ (ì‰¬ì›€/ì¤‘/ì–´ë ¤ì›€)')||'ì¤‘';
      questions.push({q,opts,answer:ans,explanation:exp,difficulty:diff});
      state.shuffled = shuffledIndices(questions.length);init();renderQuestion();
    });

    downloadBtn.addEventListener('click',()=>{
      const blob = new Blob([document.documentElement.outerHTML],{type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');a.href=url;a.download='ecoquiz.html';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);
    });

    // timer tick
    setInterval(()=>{
      if(state.started && state.timeStart){
        const sec = Math.floor((Date.now()-state.timeStart)/1000);
        const m = String(Math.floor(sec/60)).padStart(2,'0');
        const s = String(sec%60).padStart(2,'0');
        timerEl.textContent = `â±ï¸ ${m}:${s}`;
      }
    },500);

    function finishQuiz(){
      state.started=false;
      const msg = `í€´ì¦ˆ ì™„ë£Œ! ì ìˆ˜ ${state.score}ì `;
      alert(msg);
      triggerConfetti(120);
    }

    // Simple confetti engine
    const confettiPieces = [];
    function triggerConfetti(n=40){
      if(!cc) return;
      for(let i=0;i<n;i++){
        confettiPieces.push({
          x: Math.random()*confettiCanvas.width,
          y: -10 - Math.random()*50,
          vx: -2 + Math.random()*4,
          vy: 1+Math.random()*6,
          size: 6+Math.random()*10,
          rot: Math.random()*360,
          vr: -5 + Math.random()*10,
          color: `hsl(${Math.random()*360} 80% 60%)`,
          life: 0, ttl: 80+Math.random()*80
        });
      }
      if(!confettiAnimating) {confettiAnimating=true;requestAnimationFrame(confettiLoop)}
    }
    let confettiAnimating = false;
    function confettiLoop(){
      if(!cc) return;
      cc.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
      for(let i=confettiPieces.length-1;i>=0;i--){
        const p = confettiPieces[i];
        p.x += p.vx; p.y += p.vy; p.vy += 0.15; p.rot += p.vr; p.life++;
        cc.save(); cc.translate(p.x,p.y); cc.rotate(p.rot*Math.PI/180);
        cc.fillStyle = p.color; cc.fillRect(-p.size/2,-p.size/2,p.size,p.size*0.6);
        cc.restore();
        if(p.life>p.ttl || p.y>confettiCanvas.height+50) confettiPieces.splice(i,1);
      }
      if(confettiPieces.length>0) requestAnimationFrame(confettiLoop); else confettiAnimating=false;
    }

    // initialize app
    init();

    // for convenience expose some data for editing in console
    window.EcoQuiz = {questions, state};
  </script>
</body>
</html>
